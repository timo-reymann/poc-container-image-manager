{% for platform in platforms %}
  build-{{ image.name }}-{{ platform }}:
    runs-on: ubuntu-latest
    container: registry.example.com/ci/image-manager:latest
{%- if image.dependencies %}
    needs:
{%- for dep in image.dependencies %}
      - manifest-{{ dep }}
{%- endfor %}
{%- endif %}
    steps:
      - uses: actions/checkout@v4
      - run: image-manager build {{ image.name }} --platform {{ platform }} --snapshot-id "$SNAPSHOT_ID"
      - run: image-manager sbom {{ image.name }} --platform {{ platform }} --snapshot-id "$SNAPSHOT_ID"
{% endfor %}
