# Auto-generated by image-manager generate-ci
# Generated: 2026-01-30T09:12:06.819591+00:00
# Do not edit - regenerate with: image-manager generate-ci --provider github

name: Build Images

on:
  push:
    branches: [main]
  pull_request:
    branches: [main]

env:
  SNAPSHOT_ID: ${{ github.event.pull_request.number }}

jobs:

  # === BASE ===

  build-base-amd64:
    runs-on: ubuntu-latest
    container: registry.example.com/ci/image-manager:latest
    steps:
      - uses: actions/checkout@v4
      - run: image-manager build base --platform amd64 --snapshot-id "$SNAPSHOT_ID"
      - run: image-manager sbom base --platform amd64 --snapshot-id "$SNAPSHOT_ID"

  build-base-arm64:
    runs-on: ubuntu-latest
    container: registry.example.com/ci/image-manager:latest
    steps:
      - uses: actions/checkout@v4
      - run: image-manager build base --platform arm64 --snapshot-id "$SNAPSHOT_ID"
      - run: image-manager sbom base --platform arm64 --snapshot-id "$SNAPSHOT_ID"

  manifest-base:
    runs-on: ubuntu-latest
    container: registry.example.com/ci/image-manager:latest
    needs:
      - build-base-amd64
      - build-base-arm64
    steps:
      - uses: actions/checkout@v4
      - run: image-manager manifest base --snapshot-id "$SNAPSHOT_ID"
  test-base:
    runs-on: ubuntu-latest
    container: registry.example.com/ci/image-manager:latest
    needs:
      - manifest-base
    steps:
      - uses: actions/checkout@v4
      - run: image-manager test base --snapshot-id "$SNAPSHOT_ID"


  # === DOTNET ===

  build-dotnet-amd64:
    runs-on: ubuntu-latest
    container: registry.example.com/ci/image-manager:latest
    needs:
      - manifest-base
    steps:
      - uses: actions/checkout@v4
      - run: image-manager build dotnet --platform amd64 --snapshot-id "$SNAPSHOT_ID"
      - run: image-manager sbom dotnet --platform amd64 --snapshot-id "$SNAPSHOT_ID"

  build-dotnet-arm64:
    runs-on: ubuntu-latest
    container: registry.example.com/ci/image-manager:latest
    needs:
      - manifest-base
    steps:
      - uses: actions/checkout@v4
      - run: image-manager build dotnet --platform arm64 --snapshot-id "$SNAPSHOT_ID"
      - run: image-manager sbom dotnet --platform arm64 --snapshot-id "$SNAPSHOT_ID"

  manifest-dotnet:
    runs-on: ubuntu-latest
    container: registry.example.com/ci/image-manager:latest
    needs:
      - build-dotnet-amd64
      - build-dotnet-arm64
    steps:
      - uses: actions/checkout@v4
      - run: image-manager manifest dotnet --snapshot-id "$SNAPSHOT_ID"
  test-dotnet:
    runs-on: ubuntu-latest
    container: registry.example.com/ci/image-manager:latest
    needs:
      - manifest-dotnet
    steps:
      - uses: actions/checkout@v4
      - run: image-manager test dotnet --snapshot-id "$SNAPSHOT_ID"


  # === DOTNET ===

  build-dotnet-amd64:
    runs-on: ubuntu-latest
    container: registry.example.com/ci/image-manager:latest
    needs:
      - manifest-base
    steps:
      - uses: actions/checkout@v4
      - run: image-manager build dotnet --platform amd64 --snapshot-id "$SNAPSHOT_ID"
      - run: image-manager sbom dotnet --platform amd64 --snapshot-id "$SNAPSHOT_ID"

  build-dotnet-arm64:
    runs-on: ubuntu-latest
    container: registry.example.com/ci/image-manager:latest
    needs:
      - manifest-base
    steps:
      - uses: actions/checkout@v4
      - run: image-manager build dotnet --platform arm64 --snapshot-id "$SNAPSHOT_ID"
      - run: image-manager sbom dotnet --platform arm64 --snapshot-id "$SNAPSHOT_ID"

  manifest-dotnet:
    runs-on: ubuntu-latest
    container: registry.example.com/ci/image-manager:latest
    needs:
      - build-dotnet-amd64
      - build-dotnet-arm64
    steps:
      - uses: actions/checkout@v4
      - run: image-manager manifest dotnet --snapshot-id "$SNAPSHOT_ID"
  test-dotnet:
    runs-on: ubuntu-latest
    container: registry.example.com/ci/image-manager:latest
    needs:
      - manifest-dotnet
    steps:
      - uses: actions/checkout@v4
      - run: image-manager test dotnet --snapshot-id "$SNAPSHOT_ID"


  # === PYTHON ===

  build-python-amd64:
    runs-on: ubuntu-latest
    container: registry.example.com/ci/image-manager:latest
    needs:
      - manifest-base
    steps:
      - uses: actions/checkout@v4
      - run: image-manager build python --platform amd64 --snapshot-id "$SNAPSHOT_ID"
      - run: image-manager sbom python --platform amd64 --snapshot-id "$SNAPSHOT_ID"

  build-python-arm64:
    runs-on: ubuntu-latest
    container: registry.example.com/ci/image-manager:latest
    needs:
      - manifest-base
    steps:
      - uses: actions/checkout@v4
      - run: image-manager build python --platform arm64 --snapshot-id "$SNAPSHOT_ID"
      - run: image-manager sbom python --platform arm64 --snapshot-id "$SNAPSHOT_ID"

  manifest-python:
    runs-on: ubuntu-latest
    container: registry.example.com/ci/image-manager:latest
    needs:
      - build-python-amd64
      - build-python-arm64
    steps:
      - uses: actions/checkout@v4
      - run: image-manager manifest python --snapshot-id "$SNAPSHOT_ID"
  test-python:
    runs-on: ubuntu-latest
    container: registry.example.com/ci/image-manager:latest
    needs:
      - manifest-python
    steps:
      - uses: actions/checkout@v4
      - run: image-manager test python --snapshot-id "$SNAPSHOT_ID"


