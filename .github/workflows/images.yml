# Auto-generated by image-manager generate-ci
# Generated: 2026-01-30T09:08:35.533477+00:00
# Do not edit - regenerate with: image-manager generate-ci --provider github

name: Build Images

on:
  push:
    branches: [main]
  pull_request:
    branches: [main]

env:
  SNAPSHOT_ID: ${{ github.event.pull_request.number }}

jobs:

  # === BASE ===

  build-base-amd64:
    runs-on: ubuntu-latest
    container: registry.example.com/ci/image-manager:latest
    steps:
      - uses: actions/checkout@v4
      - run: image-manager build base --platform amd64 --snapshot-id "$SNAPSHOT_ID"
      - run: image-manager sbom base --platform amd64 --snapshot-id "$SNAPSHOT_ID"
      - uses: actions/upload-artifact@v4
        with:
          name: base-amd64
          path: dist/base/*/linux-amd64/
          retention-days: 7

  build-base-arm64:
    runs-on: ubuntu-latest
    container: registry.example.com/ci/image-manager:latest
    steps:
      - uses: actions/checkout@v4
      - run: image-manager build base --platform arm64 --snapshot-id "$SNAPSHOT_ID"
      - run: image-manager sbom base --platform arm64 --snapshot-id "$SNAPSHOT_ID"
      - uses: actions/upload-artifact@v4
        with:
          name: base-arm64
          path: dist/base/*/linux-arm64/
          retention-days: 7

  manifest-base:
    runs-on: ubuntu-latest
    container: registry.example.com/ci/image-manager:latest
    needs:
      - build-base-amd64
      - build-base-arm64
    steps:
      - uses: actions/checkout@v4
      - uses: actions/download-artifact@v4
        with:
          name: base-amd64
          path: dist/
      - uses: actions/download-artifact@v4
        with:
          name: base-arm64
          path: dist/
      - run: image-manager manifest base --snapshot-id "$SNAPSHOT_ID"
      - uses: actions/upload-artifact@v4
        with:
          name: base-manifest
          path: |
            dist/base/*/image.tar
            dist/base/*/index.html
          retention-days: 7
  test-base:
    runs-on: ubuntu-latest
    container: registry.example.com/ci/image-manager:latest
    needs:
      - manifest-base
    steps:
      - uses: actions/checkout@v4
      - uses: actions/download-artifact@v4
        with:
          name: base-manifest
          path: dist/
      - run: image-manager test base --snapshot-id "$SNAPSHOT_ID"


  # === DOTNET ===

  build-dotnet-amd64:
    runs-on: ubuntu-latest
    container: registry.example.com/ci/image-manager:latest
    needs:
      - manifest-base
    steps:
      - uses: actions/checkout@v4
      - run: image-manager build dotnet --platform amd64 --snapshot-id "$SNAPSHOT_ID"
      - run: image-manager sbom dotnet --platform amd64 --snapshot-id "$SNAPSHOT_ID"
      - uses: actions/upload-artifact@v4
        with:
          name: dotnet-amd64
          path: dist/dotnet/*/linux-amd64/
          retention-days: 7

  build-dotnet-arm64:
    runs-on: ubuntu-latest
    container: registry.example.com/ci/image-manager:latest
    needs:
      - manifest-base
    steps:
      - uses: actions/checkout@v4
      - run: image-manager build dotnet --platform arm64 --snapshot-id "$SNAPSHOT_ID"
      - run: image-manager sbom dotnet --platform arm64 --snapshot-id "$SNAPSHOT_ID"
      - uses: actions/upload-artifact@v4
        with:
          name: dotnet-arm64
          path: dist/dotnet/*/linux-arm64/
          retention-days: 7

  manifest-dotnet:
    runs-on: ubuntu-latest
    container: registry.example.com/ci/image-manager:latest
    needs:
      - build-dotnet-amd64
      - build-dotnet-arm64
    steps:
      - uses: actions/checkout@v4
      - uses: actions/download-artifact@v4
        with:
          name: dotnet-amd64
          path: dist/
      - uses: actions/download-artifact@v4
        with:
          name: dotnet-arm64
          path: dist/
      - run: image-manager manifest dotnet --snapshot-id "$SNAPSHOT_ID"
      - uses: actions/upload-artifact@v4
        with:
          name: dotnet-manifest
          path: |
            dist/dotnet/*/image.tar
            dist/dotnet/*/index.html
          retention-days: 7
  test-dotnet:
    runs-on: ubuntu-latest
    container: registry.example.com/ci/image-manager:latest
    needs:
      - manifest-dotnet
    steps:
      - uses: actions/checkout@v4
      - uses: actions/download-artifact@v4
        with:
          name: dotnet-manifest
          path: dist/
      - run: image-manager test dotnet --snapshot-id "$SNAPSHOT_ID"


  # === DOTNET ===

  build-dotnet-amd64:
    runs-on: ubuntu-latest
    container: registry.example.com/ci/image-manager:latest
    needs:
      - manifest-base
    steps:
      - uses: actions/checkout@v4
      - run: image-manager build dotnet --platform amd64 --snapshot-id "$SNAPSHOT_ID"
      - run: image-manager sbom dotnet --platform amd64 --snapshot-id "$SNAPSHOT_ID"
      - uses: actions/upload-artifact@v4
        with:
          name: dotnet-amd64
          path: dist/dotnet/*/linux-amd64/
          retention-days: 7

  build-dotnet-arm64:
    runs-on: ubuntu-latest
    container: registry.example.com/ci/image-manager:latest
    needs:
      - manifest-base
    steps:
      - uses: actions/checkout@v4
      - run: image-manager build dotnet --platform arm64 --snapshot-id "$SNAPSHOT_ID"
      - run: image-manager sbom dotnet --platform arm64 --snapshot-id "$SNAPSHOT_ID"
      - uses: actions/upload-artifact@v4
        with:
          name: dotnet-arm64
          path: dist/dotnet/*/linux-arm64/
          retention-days: 7

  manifest-dotnet:
    runs-on: ubuntu-latest
    container: registry.example.com/ci/image-manager:latest
    needs:
      - build-dotnet-amd64
      - build-dotnet-arm64
    steps:
      - uses: actions/checkout@v4
      - uses: actions/download-artifact@v4
        with:
          name: dotnet-amd64
          path: dist/
      - uses: actions/download-artifact@v4
        with:
          name: dotnet-arm64
          path: dist/
      - run: image-manager manifest dotnet --snapshot-id "$SNAPSHOT_ID"
      - uses: actions/upload-artifact@v4
        with:
          name: dotnet-manifest
          path: |
            dist/dotnet/*/image.tar
            dist/dotnet/*/index.html
          retention-days: 7
  test-dotnet:
    runs-on: ubuntu-latest
    container: registry.example.com/ci/image-manager:latest
    needs:
      - manifest-dotnet
    steps:
      - uses: actions/checkout@v4
      - uses: actions/download-artifact@v4
        with:
          name: dotnet-manifest
          path: dist/
      - run: image-manager test dotnet --snapshot-id "$SNAPSHOT_ID"


  # === PYTHON ===

  build-python-amd64:
    runs-on: ubuntu-latest
    container: registry.example.com/ci/image-manager:latest
    needs:
      - manifest-base
    steps:
      - uses: actions/checkout@v4
      - run: image-manager build python --platform amd64 --snapshot-id "$SNAPSHOT_ID"
      - run: image-manager sbom python --platform amd64 --snapshot-id "$SNAPSHOT_ID"
      - uses: actions/upload-artifact@v4
        with:
          name: python-amd64
          path: dist/python/*/linux-amd64/
          retention-days: 7

  build-python-arm64:
    runs-on: ubuntu-latest
    container: registry.example.com/ci/image-manager:latest
    needs:
      - manifest-base
    steps:
      - uses: actions/checkout@v4
      - run: image-manager build python --platform arm64 --snapshot-id "$SNAPSHOT_ID"
      - run: image-manager sbom python --platform arm64 --snapshot-id "$SNAPSHOT_ID"
      - uses: actions/upload-artifact@v4
        with:
          name: python-arm64
          path: dist/python/*/linux-arm64/
          retention-days: 7

  manifest-python:
    runs-on: ubuntu-latest
    container: registry.example.com/ci/image-manager:latest
    needs:
      - build-python-amd64
      - build-python-arm64
    steps:
      - uses: actions/checkout@v4
      - uses: actions/download-artifact@v4
        with:
          name: python-amd64
          path: dist/
      - uses: actions/download-artifact@v4
        with:
          name: python-arm64
          path: dist/
      - run: image-manager manifest python --snapshot-id "$SNAPSHOT_ID"
      - uses: actions/upload-artifact@v4
        with:
          name: python-manifest
          path: |
            dist/python/*/image.tar
            dist/python/*/index.html
          retention-days: 7
  test-python:
    runs-on: ubuntu-latest
    container: registry.example.com/ci/image-manager:latest
    needs:
      - manifest-python
    steps:
      - uses: actions/checkout@v4
      - uses: actions/download-artifact@v4
        with:
          name: python-manifest
          path: dist/
      - run: image-manager test python --snapshot-id "$SNAPSHOT_ID"


