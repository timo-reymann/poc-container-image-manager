# Auto-generated by image-manager generate-ci
# Generated: 2026-01-02T14:19:24.887388+00:00
# Do not edit - regenerate with: uv run image-manager generate-ci

stages:
  - build-base
  - manifest-base
  - build-dotnet
  - manifest-dotnet
  - build-python
  - manifest-python
  - test

variables:
  SNAPSHOT_ID: ${CI_MERGE_REQUEST_IID}


# === BASE ===

build-base-amd64:
  stage: build-base
  script:
    - uv run image-manager build base --platform amd64 --snapshot-id "$SNAPSHOT_ID"
    - uv run image-manager sbom base --platform amd64 --snapshot-id "$SNAPSHOT_ID"

build-base-arm64:
  stage: build-base
  script:
    - uv run image-manager build base --platform arm64 --snapshot-id "$SNAPSHOT_ID"
    - uv run image-manager sbom base --platform arm64 --snapshot-id "$SNAPSHOT_ID"

manifest-base:
  stage: manifest-base
  needs:
    - build-base-amd64
    - build-base-arm64
  script:
    - uv run image-manager manifest base --snapshot-id "$SNAPSHOT_ID"

test-base:
  stage: test
  needs:
    - manifest-base
  script:
    - uv run image-manager test base --snapshot-id "$SNAPSHOT_ID"


# === DOTNET ===

build-dotnet-amd64:
  stage: build-dotnet
  needs:
    - manifest-base
  script:
    - uv run image-manager build dotnet --platform amd64 --snapshot-id "$SNAPSHOT_ID"
    - uv run image-manager sbom dotnet --platform amd64 --snapshot-id "$SNAPSHOT_ID"

build-dotnet-arm64:
  stage: build-dotnet
  needs:
    - manifest-base
  script:
    - uv run image-manager build dotnet --platform arm64 --snapshot-id "$SNAPSHOT_ID"
    - uv run image-manager sbom dotnet --platform arm64 --snapshot-id "$SNAPSHOT_ID"

manifest-dotnet:
  stage: manifest-dotnet
  needs:
    - build-dotnet-amd64
    - build-dotnet-arm64
  script:
    - uv run image-manager manifest dotnet --snapshot-id "$SNAPSHOT_ID"

test-dotnet:
  stage: test
  needs:
    - manifest-dotnet
  script:
    - uv run image-manager test dotnet --snapshot-id "$SNAPSHOT_ID"


# === PYTHON ===

build-python-amd64:
  stage: build-python
  needs:
    - manifest-base
  script:
    - uv run image-manager build python --platform amd64 --snapshot-id "$SNAPSHOT_ID"
    - uv run image-manager sbom python --platform amd64 --snapshot-id "$SNAPSHOT_ID"

build-python-arm64:
  stage: build-python
  needs:
    - manifest-base
  script:
    - uv run image-manager build python --platform arm64 --snapshot-id "$SNAPSHOT_ID"
    - uv run image-manager sbom python --platform arm64 --snapshot-id "$SNAPSHOT_ID"

manifest-python:
  stage: manifest-python
  needs:
    - build-python-amd64
    - build-python-arm64
  script:
    - uv run image-manager manifest python --snapshot-id "$SNAPSHOT_ID"

test-python:
  stage: test
  needs:
    - manifest-python
  script:
    - uv run image-manager test python --snapshot-id "$SNAPSHOT_ID"

