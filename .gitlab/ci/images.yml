# Auto-generated by image-manager generate-ci
# Generated: 2026-01-30T09:12:06.433823+00:00
# Do not edit - regenerate with: image-manager generate-ci

stages:
  - build-base
  - manifest-base
  - build-dotnet
  - manifest-dotnet
  - build-dotnet
  - manifest-dotnet
  - build-python
  - manifest-python
  - test

variables:
  SNAPSHOT_ID: ${CI_MERGE_REQUEST_IID}

# === BASE TEMPLATES ===

.build:
  image: registry.example.com/ci/image-manager:latest
  script:
    - image-manager build ${IMAGE_NAME} --platform ${PLATFORM} --snapshot-id "$SNAPSHOT_ID"
    - image-manager sbom ${IMAGE_NAME} --platform ${PLATFORM} --snapshot-id "$SNAPSHOT_ID"

.manifest:
  image: registry.example.com/ci/image-manager:latest
  script:
    - image-manager manifest ${IMAGE_NAME} --snapshot-id "$SNAPSHOT_ID"

.test:
  image: registry.example.com/ci/image-manager:latest
  stage: test
  script:
    - image-manager test ${IMAGE_NAME} --snapshot-id "$SNAPSHOT_ID"


# === BASE ===

build-base-amd64:
  extends: .build
  stage: build-base
  variables:
    IMAGE_NAME: base
    PLATFORM: amd64

build-base-arm64:
  extends: .build
  stage: build-base
  variables:
    IMAGE_NAME: base
    PLATFORM: arm64

manifest-base:
  extends: .manifest
  stage: manifest-base
  variables:
    IMAGE_NAME: base
  needs:
    - build-base-amd64
    - build-base-arm64

test-base:
  extends: .test
  variables:
    IMAGE_NAME: base
  needs:
    - manifest-base


# === DOTNET ===

build-dotnet-amd64:
  extends: .build
  stage: build-dotnet
  variables:
    IMAGE_NAME: dotnet
    PLATFORM: amd64
  needs:
    - manifest-base

build-dotnet-arm64:
  extends: .build
  stage: build-dotnet
  variables:
    IMAGE_NAME: dotnet
    PLATFORM: arm64
  needs:
    - manifest-base

manifest-dotnet:
  extends: .manifest
  stage: manifest-dotnet
  variables:
    IMAGE_NAME: dotnet
  needs:
    - build-dotnet-amd64
    - build-dotnet-arm64

test-dotnet:
  extends: .test
  variables:
    IMAGE_NAME: dotnet
  needs:
    - manifest-dotnet


# === DOTNET ===

build-dotnet-amd64:
  extends: .build
  stage: build-dotnet
  variables:
    IMAGE_NAME: dotnet
    PLATFORM: amd64
  needs:
    - manifest-base

build-dotnet-arm64:
  extends: .build
  stage: build-dotnet
  variables:
    IMAGE_NAME: dotnet
    PLATFORM: arm64
  needs:
    - manifest-base

manifest-dotnet:
  extends: .manifest
  stage: manifest-dotnet
  variables:
    IMAGE_NAME: dotnet
  needs:
    - build-dotnet-amd64
    - build-dotnet-arm64

test-dotnet:
  extends: .test
  variables:
    IMAGE_NAME: dotnet
  needs:
    - manifest-dotnet


# === PYTHON ===

build-python-amd64:
  extends: .build
  stage: build-python
  variables:
    IMAGE_NAME: python
    PLATFORM: amd64
  needs:
    - manifest-base

build-python-arm64:
  extends: .build
  stage: build-python
  variables:
    IMAGE_NAME: python
    PLATFORM: arm64
  needs:
    - manifest-base

manifest-python:
  extends: .manifest
  stage: manifest-python
  variables:
    IMAGE_NAME: python
  needs:
    - build-python-amd64
    - build-python-arm64

test-python:
  extends: .test
  variables:
    IMAGE_NAME: python
  needs:
    - manifest-python

